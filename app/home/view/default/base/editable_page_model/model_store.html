<div class='editable-page-model'>
<form id="editable_model_form" action="{$Request.url}">
    <div class="dssc-form-default">
        <dl>
            <dt>{$Think.lang.ds_storeclass}</dt>
            <dd>
                <select name="storeclass_id">
                    <option value='0'>{$Think.lang.ds_common_pselect}</option>
                    {foreach name='storeclass_list' item='storeclass'}
                    <option value="{$storeclass.storeclass_id}" {if $store_info.storeclass_id==$storeclass.storeclass_id}selected{/if}>{$storeclass.storeclass_name}</option>
                    {/foreach}
                </select>
            </dd>
        </dl>
        <dl>
            <dt>{$Think.lang.ds_sort}</dt>
            <dd>
                <label class="radio-label">
                    <i  class="radio-common{if $store_info.sort=='grade'} selected{/if}">
                        <input type="radio" name="sort" value="grade"{if $store_info.sort=='grade'} checked=""{/if}>
                    </i>
                    <span>{$Think.lang.sort_by_grade}</span>
                </label>
                <label class="radio-label">
                    <i  class="radio-common{if $store_info.sort=='hot'} selected{/if}">
                        <input type="radio" name="sort" value="hot"{if $store_info.sort=='hot'} checked=""{/if}>
                    </i>
                    <span>{$Think.lang.sort_by_hot}</span>
                </label>
                <label class="radio-label">
                    <i  class="radio-common{if $store_info.sort=='good'} selected{/if}">
                        <input type="radio" name="sort" value="good"{if $store_info.sort=='good'} checked=""{/if}>
                    </i>
                    <span>{$Think.lang.sort_by_good}</span>
                </label>
            </dd>
        </dl>
        <dl>
            <dt>{$Think.lang.if_fix_store}</dt>
            <dd class="onoff">
                <label for="if_fix1" class="cb-enable {if $store_info.if_fix==1}selected{/if}" onclick="$('#fix_store').show();$(this).parent().find('.cb-disable').removeClass('selected');$(this).addClass('selected')"><span>{$Think.lang.ds_yes}</span></label>
                <label for="if_fix0" class="cb-disable {if $store_info.if_fix==0}selected{/if}" onclick="$('#fix_store').hide();$(this).parent().find('.cb-enable').removeClass('selected');$(this).addClass('selected')"><span>{$Think.lang.ds_no}</span></label>
                <input type="radio" name="if_fix" value="0"{if $store_info.if_fix==0} checked=""{/if}>
                <input type="radio" name="if_fix" value="1"{if $store_info.if_fix==1} checked=""{/if}>
                
            </dd>
        </dl>
        <div class="p15" id="fix_store"{if $store_info.if_fix==0} style='display: none'{/if}>
                <table class="dssc-default-table mb15">
                  <thead>
                    <tr>
                      <th class="tl" style="padding-left: 10px" colspan="2">{$Think.lang.ds_store_name}</th>
                      <th class="w90">{$Think.lang.ds_sort}</th>
                      <th class="w90">{$Think.lang.ds_handle}</th></tr>
                  </thead>
                  <tbody dstype="bundling_data" class="bd-line tip">
                    <tr{notempty name="store_info.store_id"} style="display:none;"{/notempty}>
                      <td colspan="20" class="norecord">
                        <div class="no-promotion">
                          <i class="zh"></i>
                          <span>{$Think.lang.ds_no_record}</span></div>
                      </td>
                    </tr>{notempty name="store_info.store_id"} {foreach name="store_list" item="val"}
                    <tr id="bundling_tr_{$val.store_id}" class="off-shelf">
                      <td class="w50">
                        <div class="shelf-state">
                          <div class="pic-thumb">
                            <img src="{:get_store_logo($val.store_avatar)}" ncname="{$val.store_avatar}" dstype="bundling_data_img"></div></div>
                      </td>
                      <td class="tl">
                        <dl class="goods-name">
                          <dt style="width: 300px;">{$val.store_name}</dt></dl>
                      </td>
                      <td class="w90"><input type="number" min="0" max="255" size="1" name="store_id[{$val.store_id}][sort]" value="{if(isset($store_info['store_id'][$val['store_id']]['sort']))}{$store_info['store_id'][$val['store_id']]['sort']}{else}255{/if}" /></td>
                      <td class="dscs-table-handle w90">
                        <span>
                          <a onclick="bundling_operate_delete($('#bundling_tr_{$val.store_id}'), {$val.store_id})" href="JavaScript:void(0);" class="btn-orange">
                            <i class="iconfont">&#xe754;</i>
                            <p>{$Think.lang.ds_del}</p>
                          </a>
                        </span>
                      </td>
                    </tr>{/foreach} {/notempty}</tbody>
                </table>
                <a id="editable_model_add_goods" href="{:url(request()->controller().'/search_store')}" class="dssc-btn dssc-btn-acidblue selected">{$Think.lang.ds_please_choose}</a>
                <div class="div-goods-select-box">
                  <div id="editable_model_goods_ajaxContent"></div>
                  <a id="editable_model_goods_delete" class="close" href="javascript:void(0);" style="display: none; right: -10px;">X</a>
                </div>
        </div>
    </div>
    <div class='tc pb20 pt20'><a class="dssc-btn" dstype="select-124" href="javascript:void(0)" onclick="submitEditableModelForm()">{$Think.lang.ds_submit}</a></div>
</form>
</div>
<script>
    $(function () {
    $(".radio-common").on("click", function () {
        var radio = $(this).children("input");
        var name = radio.attr("name");
        if (radio.is(":checked")) {
            $(".radio-common>input[type='radio'][name='" + name + "']").parent().removeClass("selected");
            $(this).addClass("selected");
        } else {
            $(this).removeClass("selected");
        }
    });
        /* ajax添加商品  */
        $('#editable_model_add_goods').ajaxContent({
            event:'click', //mouseover
            loaderType:"img",
            loadingMsg:"{$Think.HOME_SITE_ROOT}/images/loading.gif",
            target:'#editable_model_goods_ajaxContent'
        }).click(function(){
            $(this).hide();
            $('#editable_model_goods_delete').show();
        });
        $('#editable_model_goods_delete').click(function(){
            $(this).hide();
            $('#editable_model_goods_ajaxContent').html('');
            $('#editable_model_add_goods').show();
        });
        $('#editable_model_goods_ajaxContent').on('click', '.pagination li a', function() {
            $('#editable_model_goods_ajaxContent').load($(this).attr('href'));
            return false;
        });
    })

    /* 删除商品 */
    function bundling_operate_delete(o, id){
        o.remove();
        check_bundling_data_length();
        $('li[dstype="'+id+'"]').children(':last').html('<a href="JavaScript:void(0);" onclick="bundling_goods_add($(this))" class="dssc-btn-mini dssc-btn-green"><i class="iconfont">&#xe6db;</i>{$Think.lang.ds_add}</a>');
    }
    function check_bundling_data_length(){
        if ($('tbody[dstype="bundling_data"] tr').length == 1) {
            $('tbody[dstype="bundling_data"]').children(':first').show();
        }
    }
</script>

